<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chess PGN Viewer</title>
    <!-- Add jQuery before chessboard.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chessboard-js/1.0.0/chessboard-1.0.0.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chessboard-js/1.0.0/chessboard-1.0.0.min.css">
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1, h2 {
            color: #2c3e50;
        }
        .container {
            display: flex;
            flex-direction: row;
            gap: 20px;
        }
        .games-list {
            flex: 1;
            max-width: 300px;
            overflow-y: auto;
            max-height: 80vh;
            background-color: white;
            border-radius: 5px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .game-display {
            flex: 3;
            background-color: white;
            border-radius: 5px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .game-item {
            padding: 8px 12px;
            margin-bottom: 5px;
            cursor: pointer;
            border-radius: 4px;
            background-color: #f9f9f9;
            transition: background-color 0.2s;
        }
        .game-item:hover {
            background-color: #e9e9e9;
        }
        .game-item.active {
            background-color: #3498db;
            color: white;
        }
        #chessboard {
            width: 400px;
            height: 400px;
            margin: 0 auto 20px auto;
        }
        .game-info {
            margin-bottom: 20px;
        }
        .game-moves {
            font-family: 'Courier New', Courier, monospace;
            line-height: 1.8;
            max-height: 250px;
            overflow-y: auto;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 4px;
        }
        .file-input-container {
            margin-bottom: 20px;
            padding: 15px;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        button, .file-button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
        }
        button:hover, .file-button:hover {
            background-color: #2980b9;
        }
        .move-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 15px 0;
        }
        .stats {
            display: flex;
            gap: 20px;
            margin-top: 15px;
        }
        .stats div {
            flex: 1;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 4px;
        }
        .move-number {
            font-weight: bold;
            color: #7f8c8d;
        }
        .chess-move {
            font-weight: bold;
            padding: 0 3px;
            cursor: pointer;
        }
        .chess-move:hover {
            background-color: #e0e0e0;
            border-radius: 2px;
        }
        .current-move {
            background-color: #3498db;
            color: white;
            border-radius: 2px;
        }
    </style>
</head>
<body>
    <h1>Chess PGN Viewer</h1>
    
    <div class="file-input-container">
        <p>PGN file with 150 games has been loaded automatically!</p>
        <button id="load-file">Display Games</button>
    </div>
    
    <div class="container">
        <div class="games-list" id="games-list">
            <h2>Games</h2>
            <div id="games-container">
                <p>Click "Display Games" to view the chess games.</p>
            </div>
        </div>
        
        <div class="game-display">
            <div class="game-info" id="game-info">
                <h2>Game Information</h2>
                <p>No game selected. Please select a game from the list.</p>
            </div>
            
            <div id="chessboard"></div>
            
            <div class="move-controls">
                <button id="start-btn">⏮ Start</button>
                <button id="prev-btn">⏪ Previous</button>
                <button id="next-btn">Next ⏩</button>
                <button id="end-btn">End ⏭</button>
            </div>
            
            <div class="game-moves" id="game-moves"></div>
        </div>
    </div>

    <script>
        $(document).ready(function() {
            // DOM elements
            const loadButton = document.getElementById('load-file');
            const gamesContainer = document.getElementById('games-container');
            const gameInfo = document.getElementById('game-info');
            const gameMoves = document.getElementById('game-moves');
            
            // Control buttons
            const startBtn = document.getElementById('start-btn');
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const endBtn = document.getElementById('end-btn');
            
            // Game variables
            let games = [];
            let currentGameIndex = -1;
            let currentGame = null;
            let board = null;
            let chess = new Chess();
            let moveHistory = [];
            let currentMoveIndex = -1;
            
            // Initialize chessboard
            function initializeBoard() {
                if (board) {
                    board.destroy();
                }
                board = Chessboard('chessboard', {
                    position: 'start',
                });
            }
            
            // Initialize the board on page load
            initializeBoard();
            
            // Hard-coded PGN data from the loaded file
            const pgn = `[Event "?"]
[Site "?"]
[Date "????.??.??"]
[Round "?"]
[White "?"]
[Black "?"]
[Result "*"]

1. g3 Nh6 2. Nc3 b6 3. Nd5 Nc6 4. Nxe7 Bb7 5. Ng8 Ne7 6. Nxe7 Rg8 7. Nxg8 Be7 8. Nxe7 Kf8 9. Ng8 Kxg8 10. Nh3 Rb8 11. Nf4 Bxh1 12. Nd5 Kf8 13. Nf4 g6 14. Bg2 Kg8 15. Nxg6 Kg7 16. Nh8 Qxh8 17. Ba8 Qg8 18. Bb7 Qh8 19. Bc8 Qg8 20. Bxd7 Qh8 21. Be8 Qg8 22. Bxf7 Qh8 23. Bg8 Qxg8 24. Kf1 Qh8 25. Kg1 Qg8 26. Qf1 Rb7 27. Kxh1 Qf8 28. d3 Qh8 29. Kg2 Rb8 30. Bd2 Kf8 31. Bg5 Re8 32. Bf6 Qxf6 33. Re1 Nf7 34. Rd1 Re4 35. Ra1 Qe6 36. Kg1 Ng5 37. Kg2 Kg8 38. Qg1 Qh3+ *

[Event "?"]
[Site "?"]
[Date "????.??.??"]
[Round "?"]
[White "?"]
[Black "?"]
[Result "*"]

1. b3 b6 2. Nf3 g5 3. Nxg5 c6 4. e3 Bh6 5. e4 Ba6 6. Bb5 e6 7. Bxa6 Qf6 8. Ke2 Qe7 9. d3 Nf6 10. Nxf7 Qd6 11. Nxh8 Kf8 12. Bb5 Kg7 13. Qf1 Qe7 14. Nf7 Qa3 15. Nh8 Na6 16. Nf7 Rg8 17. Bxa6 Kxf7 18. Bc8 Ke8 19. Bxd7+ Kf8 20. Be8 Rg7 21. Rg1 Rf7 22. Bf4 Kg8 23. Bc1 Kg7 24. Bxf7 Nd7 25. Bg8 Kh8 26. Bxh7 Kxh7 27. Kf3 Kh8 28. Kg4 Kg8 29. Kh5 Qa5+ 30. Kxh6 Qe5 31. Na3 Qc3 32. Bg5 Nf6 33. Rh1 Kh8 34. Kg6 Kg8 35. Kh6 Kh8 36. Kg6 Kg8 *

[Event "?"]
[Site "?"]
[Date "????.??.??"]
[Round "?"]
[White "?"]
[Black "?"]
[Result "*"]

1. Nh3 Nh6 2. Ng5 Rg8 3. Nxh7 Rh8 4. Nxf8 Rg8 5. Nh7 Rh8 6. Nf8 Rg8 7. Nh7 Rh8 *

[Event "?"]
[Site "?"]
[Date "????.??.??"]
[Round "?"]
[White "?"]
[Black "?"]
[Result "*"]

1. Nh3 Nh6 2. Ng5 Rg8 3. Nxh7 Rxh7 5. b3 Nc6 6. Nd5 Ne5 7. Ne3 Nc6 8. h3 Ne5 9. f3 Nc6 10. Rg1 Ng8 11. a3 Rh5 12. Nd5 Rb8 13. b4 Nd4 14. Ne3 Rc5 15. Rb1 Ra8 16. Rh1 Nh6 17. Nf5 Ng4 18. Rg1 e6 19. Rb3 Qf6 20. Bb2 Rb8 21. Ne3 Re5 22. Rh1 Rc5 23. Nc4 Nf2 24. Na5 Qh6 25. Bc3 Qg5 26. b5 Be7 27. Nc4 Rd5 28. Nd6+ Kf8 29. Ne8 Bf6 30. Nxc7 Qg6 31. Nxd5 Kg8 32. Nb6 Kh8 33. Nxc8 Kg8 34. Ne7+ Kh8 35. Nf5 Ne4 36. Nxg7 Kg8 37. Rh2 Kh8 38. Ne8 Kg8 39. Bxd4 Kh8 40. Rc3 Nf2 41. Nd6 Kg8 42. Rc6 Re8 43. Nxe8 Kh8 44. Ng7 Kg8 45. Ne8 Kh8 46. Ng7 Kg8 *

[Event "?"]
[Site "?"]
[Date "????.??.??"]
[Round "?"]
[White "?"]
[Black "?"]
[Result "*"]

1. g3 d6 2. b3 h6 3. e3 Be6 4. Bc4 Bf5 5. Bxf7+ Kxf7 6. Nh3 Rh7 7. Ng5+ Ke8 8. Nxh7 Nf6 9. Nxf8 Kxf8 10. Rg1 Kg8 11. Rg2 Kh8 12. Rg1 Kg8 13. Rg2 Kh8 14. Rg1 *

[Event "?"]
[Site "?"]
[Date "????.??.??"]
[Round "?"]
[White "?"]
[Black "?"]
[Result "*"]

1. Nh3 Nh6 2. Ng5 Rg8 3. Nxh7 Ng4 4. f3 Rh8 5. Nxf8 Ne3 6. Nh7 Rg8 7. Rg1 Na6 8. Rh1 Nc5 9. d3 Na4 10. Rg1 Rb8 11. Nc3 Nf5 12. Kd2 Ne3 13. Ke1 Nf5 14. Kf2 Ne3 15. Kxe3 g6 16. Ne4 d6 17. Nd2 Ra8 18. Nf8 Qd7 19. Ne4 Rh8 20. Nh7 Kd8 21. Nf2 Nb6 22. Kd4 Rg8 23. a4 Rh8 24. e3 Nd5 25. Ne4 Rb8 26. Nc3 Qe6 27. Qe2 Rxh7 28. Ne4 Nc3 29. Nxc3 Qd5+ 30. Kxd5 Ke8 31. Kc4 Rh5 32. Kd4 Kf8 33. Ke4 Rc5 34. Na2 Rd5 35. Rh1 Kg8 36. Qd2 Kh8 37. Kxd5 Kg8 38. Ke4 Kh8 39. Qb4 g5 40. Qd4+ Kg8 41. Kd5 a6 42. Ke4 Kf8 43. Kd5 Bd7 44. Nb4 Rc8 45. Ra2 Kg8 46. Qe4 Kf8 47. Kd4 Kg7 48. Nxa6 Rh8 49. Nb8 Rg8 50. Nxd7 Rh8 51. Nf8 Rg8 52. Nh7 c6 53. Nf6 Kh6 54. Kc3 Rf8 55. Qg6+ Kxg6 56. Ra3 Rh8 57. Ng8 Rxg8 58. Kd4 Rh8 59. Ke4 Rg8 60. Kd4 Rh8 61. Ke4 Rg8 *

[Event "?"]
[Site "?"]
[Date "????.??.??"]
[Round "?"]
[White "?"]
[Black "?"]
[Result "*"]

1. Nh3 Nh6 2. Ng5 Rg8 3. Nxh7 Rh8 4. Nxf8 Rg8 5. Nh7 Rh8 6. Nf8 Rg8 7. Nh7 Rh8 *`;
            
            // Load button now uses the hard-coded PGN
            loadButton.addEventListener('click', function() {
                parseGames(pgn);
            });
            
            // Parse PGN into separate games
            function parseGames(pgn) {
                // Split PGN into individual games
                games = pgn.split(/\n\n(?=\[Event )/)
                    .filter(game => game.trim().length > 0);
                
                // Display games in the list
                displayGamesList();
            }
            
            // Display the list of games
            function displayGamesList() {
                gamesContainer.innerHTML = '';
                
                if (games.length === 0) {
                    gamesContainer.innerHTML = '<p>No games found in the file.</p>';
                    return;
                }
                
                games.forEach((game, index) => {
                    // Extract game headers
                    const whiteMatch = game.match(/\[White "(.*?)"\]/);
                    const blackMatch = game.match(/\[Black "(.*?)"\]/);
                    const eventMatch = game.match(/\[Event "(.*?)"\]/);
                    
                    const white = whiteMatch ? whiteMatch[1] : 'Unknown';
                    const black = blackMatch ? blackMatch[1] : 'Unknown';
                    const event = eventMatch ? eventMatch[1] : 'Unknown Event';
                    
                    const gameItem = document.createElement('div');
                    gameItem.className = 'game-item';
                    gameItem.innerHTML = `Game ${index + 1}: ${white} vs ${black}`;
                    gameItem.addEventListener('click', () => loadGame(index));
                    
                    gamesContainer.appendChild(gameItem);
                });
            }
            
            // Load a specific game
            function loadGame(index) {
                // Remove active class from all game items
                document.querySelectorAll('.game-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                // Add active class to selected game
                document.querySelectorAll('.game-item')[index].classList.add('active');
                
                currentGameIndex = index;
                currentGame = games[index];
                
                // Reset the chess game
                chess.reset();
                
                // Parse headers
                const headers = {};
                const headerRegex = /\[(.*?) "(.*?)"\]/g;
                let match;
                while ((match = headerRegex.exec(currentGame)) !== null) {
                    headers[match[1]] = match[2];
                }
                
                // Display game info
                let infoHTML = `<h2>${headers.White || 'Unknown'} vs ${headers.Black || 'Unknown'}</h2>
                    <p><strong>Event:</strong> ${headers.Event || 'Unknown'}</p>
                    <p><strong>Date:</strong> ${headers.Date || 'Unknown'}</p>
                    <p><strong>Result:</strong> ${headers.Result || 'Unknown'}</p>`;
                
                if (headers.ECO) {
                    infoHTML += `<p><strong>Opening:</strong> ${headers.ECO} ${headers.Opening || ''}</p>`;
                }
                
                gameInfo.innerHTML = infoHTML;
                
                // Parse moves
                let moveText = currentGame.replace(/\[[^\]]+\]\s*/g, '')
                    .replace(/\{[^}]*\}/g, '')  // Remove comments
                    .replace(/\([^)]*\)/g, '')  // Remove variations
                    .replace(/\d+\.\.\./g, '')  // Remove move numbers with ellipses
                    .trim();
                
                // Store move history
                moveHistory = [];
                const movesRegex = /\d+\.\s*(\S+)(?:\s+(\S+))?/g;
                
                while ((match = movesRegex.exec(moveText)) !== null) {
                    if (match[1]) moveHistory.push(match[1]);
                    if (match[2]) moveHistory.push(match[2]);
                }
                
                // Add result if it exists
                const resultMatch = moveText.match(/\s+(1-0|0-1|1\/2-1\/2|\*)\s*$/);
                if (resultMatch) {
                    // Remove result from the end of moveText
                    moveText = moveText.replace(/\s+(1-0|0-1|1\/2-1\/2|\*)\s*$/, '');
                }
                
                // Reset current move index
                currentMoveIndex = -1;
                
                // Display moves
                displayMoves();
                
                // Reset board position
                board.position('start');
            }
            
            // Display the moves with proper formatting
            function displayMoves() {
                let movesHTML = '';
                let moveIndex = 0;
                
                for (let i = 0; i < moveHistory.length; i += 2) {
                    const moveNumber = Math.floor(i / 2) + 1;
                    const whiteMove = moveHistory[i];
                    const blackMove = i + 1 < moveHistory.length ? moveHistory[i + 1] : '';
                    
                    movesHTML += `<span class="move-number">${moveNumber}.</span> `;
                    movesHTML += `<span class="chess-move" data-move-index="${moveIndex}">${whiteMove}</span> `;
                    moveIndex++;
                    
                    if (blackMove) {
                        movesHTML += `<span class="chess-move" data-move-index="${moveIndex}">${blackMove}</span> `;
                        moveIndex++;
                    }
                    
                    movesHTML += ' ';
                }
                
                gameMoves.innerHTML = movesHTML;
                
                // Add click events to moves
                document.querySelectorAll('.chess-move').forEach(moveElement => {
                    moveElement.addEventListener('click', function() {
                        const moveIndex = parseInt(this.getAttribute('data-move-index'));
                        jumpToMove(moveIndex);
                    });
                });
            }
            
            // Make a move on the board
            function makeMove(moveIndex) {
                if (moveIndex < 0 || moveIndex >= moveHistory.length) {
                    return;
                }
                
                // Reset chess position
                chess.reset();
                
                // Play all moves up to the current move
                for (let i = 0; i <= moveIndex; i++) {
                    try {
                        chess.move(moveHistory[i]);
                    } catch (e) {
                        console.error(`Invalid move: ${moveHistory[i]}`, e);
                    }
                }
                
                // Update board position
                board.position(chess.fen());
                
                // Update current move index
                currentMoveIndex = moveIndex;
                
                // Highlight current move
                document.querySelectorAll('.chess-move').forEach(move => {
                    move.classList.remove('current-move');
                });
                
                const currentMoveElement = document.querySelector(`.chess-move[data-move-index="${currentMoveIndex}"]`);
                if (currentMoveElement) {
                    currentMoveElement.classList.add('current-move');
                    currentMoveElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }
            
            // Jump to a specific move
            function jumpToMove(moveIndex) {
                makeMove(moveIndex);
            }
            
            // Control button handlers
            startBtn.addEventListener('click', () => {
                board.position('start');
                currentMoveIndex = -1;
                document.querySelectorAll('.chess-move').forEach(move => {
                    move.classList.remove('current-move');
                });
            });
            
            prevBtn.addEventListener('click', () => {
                if (currentMoveIndex > 0) {
                    makeMove(currentMoveIndex - 1);
                } else if (currentMoveIndex === 0) {
                    startBtn.click();
                }
            });
            
            nextBtn.addEventListener('click', () => {
                if (currentMoveIndex < moveHistory.length - 1) {
                    makeMove(currentMoveIndex + 1);
                }
            });
            
            endBtn.addEventListener('click', () => {
                if (moveHistory.length > 0) {
                    makeMove(moveHistory.length - 1);
                }
            });
        });
    </script>
</body>
</html>
